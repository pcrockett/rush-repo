#!/usr/bin/env bash
set -Eeuo pipefail

#
# Example usage:
#
#     fzpu follow
#     fzpu log --full
#

CLI_ARGS=("${@}")

select_job_ids() {
    pueue status \
        | grep --perl-regexp '^─+$' --invert-match \
        | grep --perl-regexp '^═+$' --invert-match \
        | fzf --header-lines 2 --multi --tac --height 10 \
        | awk '{print $1}'
}

main() {
    if [ "${#CLI_ARGS[@]}" -eq 0 ]; then
        # user just wants to see `pueue status`
        pueue status
        exit 0
    fi

    local jobs
    jobs="$(select_job_ids)"
    test "${jobs}" != "" || exit 1  # user probably hit ctrl+c in fzf interface

    echo "${jobs}" | xargs pueue "${CLI_ARGS[@]}"
}

main
